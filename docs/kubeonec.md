# Kubeonec

Сервер 1С:Предприятия в кластере kubernetes

**Оглавление**

- [Kubeonec](#kubeonec)
  - [Описание](#описание)
  - [Сборка образов](#сборка-образов)
    - [Сервер 1С:Предприятие](#сервер-1спредприятие)
    - [Сервер RAS](#сервер-ras)
    - [API клиент для управления кластером](#api-клиент-для-управления-кластером)
    - [Клиент 1С:Предприятие](#клиент-1спредприятие)
      - [Odin](#odin)
  - [Запуск кластера](#запуск-кластера)
    - [Состав инстанса](#состав-инстанса)
    - [StatefilSet - приложения](#statefilset---приложения)
      - [onec-server](#onec-server)
      - [Postgres](#postgres)
        - [Хранение данных базы данных](#хранение-данных-базы-данных)
    - [Deployment](#deployment)
      - [onec-cluster-api](#onec-cluster-api)
        - [onec-cluster-rac](#onec-cluster-rac)
        - [ra-api](#ra-api)
          - [ODIN](#odin-1)
          - [Другие](#другие)

## Описание

Запуск сервера 1С:Предприятие в кластере kubernates официально не поддерживается вендером, по этому все что мы делаем является экспериментальными проектами и не подходят в работе по продуктивном окружении. Использование данного проекта целиком и полностью на вашей ответственности и разработчик не несет никакой ответственности за какие либо проблемы или потерю данных.  

Документация пока носит пока служебный формат и пока по факту является моими набросками для запуска и отладки. В дальнейшем будет приведена в нормальное состояние.


## Сборка образов

### Сервер 1С:Предприятие 
Сервер 1С:Предприятие 

### Сервер RAS
Сервер RAS

### API клиент для управления кластером
API клиент для управления кластером

### Клиент 1С:Предприятие
Клиент 1С:Предприятие

#### Odin
Репозитарий с актуальной версией Odin доступен на docker.com

## Запуск кластера

### Состав инстанса

Инстанс 1С:Предприятие состоит из нескольких подов. Настройка подов оcуществляется через файл переменных чарта `values.yaml`


### StatefilSet - приложения

#### onec-server 

Сервер 1С:Предприятия запускаемый как Statefil приложение. 

По умолчанию публикуются порты:

```
1560-1591 - для рабочего процесса;
1541 - для менеджера кластера;
1540 - для агента сервера (не обязательно, если центральный сервер кластера один).
```

При развертывании создаются под с именем:
```
<нelm-name>-kubeonec-onec-server-<Index>
```
Например, 
```
onec-server-kubeonec-onec-server-0 
```


#### Postgres

Сервер баз данных на базе образа `syuzyov/docker-postgresql-pro-1c`

*Имя пользователя базы данных* - postgres
*Пароль пользователя* - не установлен


При развертывании создаются под с именем:
```
<нelm-name>-kubeonec-postgres-<Index>
```
Например, 
```
onec-server-kubeonec-postgres-0 
```

##### Хранение данных базы данных

В текущей версии данные не сохраняются.


### Deployment 

#### onec-cluster-api

Под управления кластером состоит из 2х контейнеров:

##### onec-cluster-rac

Сервер администрирования кластера серверов 1C:Предприятия

##### ra-api

Приложение, реализующее API интерфейс для управления кластером 1С

###### ODIN

Комерческое решение от [Алексея Хорева](https://github.com/khorevaa)

###### Другие

TODO
